<!DOCTYPE html>
<html lang="en-uk">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.31.1" />
  <meta name="author" content="Stuart Lacy">
  <meta name="description" content="Research Fellow">

  
  <link rel="alternate" hreflang="en-uk" href="/2017/04/07/an-interactive-multi-state-modelling-shiny-web-app/">

  
  


  

  
  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700%7cMerriweather%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-110705129-1', 'auto');
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/2017/04/07/an-interactive-multi-state-modelling-shiny-web-app/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@stulacy">
  <meta property="twitter:creator" content="@stulacy">
  
  <meta property="og:site_name" content="Stuart Lacy">
  <meta property="og:url" content="/2017/04/07/an-interactive-multi-state-modelling-shiny-web-app/">
  <meta property="og:title" content="An interactive Multi-State Modelling Shiny web app | Stuart Lacy">
  <meta property="og:description" content="">
  <meta property="og:locale" content="en-uk">
  
  <meta property="article:published_time" content="2017-04-07T00:00:00&#43;01:00">
  
  <meta property="article:modified_time" content="2017-10-06T00:00:00&#43;01:00">
  

  

  <title>An interactive Multi-State Modelling Shiny web app | Stuart Lacy</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Stuart Lacy</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        

        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/post">
            
            <span>Blog</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/publication">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <div class="article-inner">
      <h1 itemprop="name">An interactive Multi-State Modelling Shiny web app</h1>

      

<div class="article-metadata">

  <span class="article-date">
    
        Last updated on
    
    <time datetime="2017-04-07 00:00:00 &#43;0100 BST" itemprop="datePublished">
      Oct 6, 2017
    </time>
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    3 min read
  </span>
  

  
  
  <span class="middot-divider"></span>
  <a href="/2017/04/07/an-interactive-multi-state-modelling-shiny-web-app/#disqus_thread"></a>
  

  

  
  

  

</div>


      <div class="article-style" itemprop="articleBody">
        <p>In the last couple of months I&rsquo;ve been teaching myself about multi-state survival models for use in an upcoming project. While I found the theoretical concepts relatively straight forward, I started having issues when I began to start implementing the models in software. There are many considerations to be made when building a multi-state model, such as:</p>

<ul>
<li>Convert the data into a suitable long format</li>
<li>Deciding whether to use either parametric or semi-parametric models</li>
<li>Different subsets of the available covariates can be selected for each of the transition hazards</li>
<li>In addition, covariates can be forced to have the same hazard ratio on every transition</li>
<li>There&rsquo;s a choice to be made between clock-forward or clock-reset (semi-Markov models) time-scales</li>
<li>The Markov assumption can be further violated by including the state arrival times as part of the transition hazard; this often has theoretical justification</li>
<li>The baseline hazards can be kept stratified by transition, or certain ones can be assumed to be proportional</li>
</ul>

<p>Needless to say, actually building a model was very time consuming. While I knew in my head what model for the transition hazards I wanted to use, I found the actual software implementation in R - in particular the <code>mstate</code> and <code>flexsurv</code> packages - wasn&rsquo;t very intuitive. I realised I was spending more time trying to figure how to implement a state-arrival time covariate for a transition, for example, than actually thinking about the model at a higher level.</p>

<p>To help address this, I developed an interactive web app to abstract the software implementation details away so that the model builder can instead focus on the models themselves.</p>

<p>The app takes you through the process of building a multi-state model, abstracting the somewhat intimdating syntax of both <code>mstate</code> and <code>flexsurv</code>, allowing for semi and fully parametric models to be built without having to write any R code. The app allows for control of a number of settings, such as whether to use a clock-forward or clock-reset model, and whether to include time-since-entry in any transitions. Transition-specific covariate and baseline hazards can be fitted, or they can be grouped together. All these options are available in both <code>mstate</code> and <code>flexsurv</code>, but the manner in which they are implemented depends on the package and can be somewhat overwhelming for a novice user.</p>

<p>Because I&rsquo;m unimaginative, I named this app <code>MSM-Shiny</code>. While I initially developed this app for myself to streamline my model building and data exploration pipeline, I realised it could benefit others and so developed it into a fully configurable app. I debuted it at the 6th Survival Analysis for Junior Researchers conference this past week in Leicester, where my presentation received the Best Presentation award.</p>

<p>The first step in the app is to specify the state structure. A long CSV date file is input into the app, with state entry time and censoring indicators provided in a specific format. From this, the app determines the state names, with the user selecting possible transitions from drop-down menu items.</p>

<p><img src="/img/msmshinyapp/states.png" alt="state specification" /></p>

<p>Next, a model can be built by slecting various options on the left pane (the pane scrolls down further), including which covariates impact on which transitions, whether baseline hazards proportional, whether to use a clock-forward or clock-reset model, and whether to incorporate time-since-entry in any intermediary states. A number of parametric distributions can be used, as well as a standard Cox proportional hazards regression.</p>

<p><img src="/img/msmshinyapp/coef.png" alt="coef" /></p>

<p>Each model that is fitted can be saved and compared, in terms of their coefficients, as well as their predicted survival curve for an example individual.</p>

<p><img src="/img/msmshinyapp/modelcomparison.png" alt="model comparison" /></p>

<p>Finally, state occupancy probabilities can be estimated for specified individuals. These are conveyed both graphically, and in the form of an animation.</p>

<p><img src="/img/msmshinyapp/stateprobabilities.png" alt="state probabilities" /></p>

<p>The app is available on <a href="https://stulacy.shinyapps.io/msm-shiny/" target="_blank">ShinyApps.io</a> and the code is freely available on my <a href="https://github.com/stulacy/msm-shiny" target="_blank">Github page</a>; I&rsquo;d love to hear any feedback.</p>

      </div>

      


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/r">R</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/software-development">software development</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/web-dev">web dev</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/multi-state-modelling">Multi-state modelling</a>
  
</div>



    </div>
  </div>

</article>



<div class="article-container article-widget">
  <div class="hr-light"></div>
  <h3>Related</h3>
  <ul>
    
    <li><a href="/2016/09/27/guide-to-publishing-r-packages-on-cran/">Guide to publishing R packages on CRAN</a></li>
    
    <li><a href="/2016/06/08/an-r-package-for-estimating-disease-prevalence-by-simulation-rprev/">An R package for estimating disease prevalence by simulation: rprev</a></li>
    
    <li><a href="/2015/07/12/tracking-thesis-writing-progress/">Tracking thesis writing progress</a></li>
    
    <li><a href="/2015/02/02/brief-update-and-future-learning-thoughts/">Brief update and future learning thoughts</a></li>
    
    <li><a href="/2015/01/06/dplyr-incompatibility-with-xtable/">Dplyr incompatibility with xtable</a></li>
    
  </ul>
</div>




<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "stulacy" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 Stuart Lacy &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script id="dsq-count-scr" src="//stulacy.disqus.com/count.js" async></script>
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

